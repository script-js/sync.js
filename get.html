<!DOCTYPE HTML>
<html>
  <head>
    <link rel="icon" id='hphficon' href="icon.png"/>
    <title>Restore | sync.js</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link href="login.css" rel="stylesheet" type="text/css" />
  </head>
  <style>
    #copyIP {
      color: white;
      border: none;
    }

    #copyIP:selection {
      background:none
    }
  </style>
  <body style="background-image: url('icon.png');background-color: #464fb0;">
    <div class="modal-content" style="height:80%;align-items:center;text-align:center;">
      <p></p>
      <img src="icon.png" style="margin:auto" />
      <div id="mc"><h1>Getting Data...</h1></div>
      <input id="copyIP"/>
      <p></p>
    </div>
    <script>
      function copy() {
        copyIP.select();
        document.execCommand("copy");
        mc.innerHTML = "<img src='done.png' /><h1>Close this window</h1>"
      }
    </script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {

    apiKey: "AIzaSyDWGbCICgDCm6XLz6gvuxnZTbsxACm-Fx4",

    authDomain: "sync-js-6aa9d.firebaseapp.com",

    projectId: "sync-js-6aa9d",

    storageBucket: "sync-js-6aa9d.appspot.com",

    messagingSenderId: "856081502457",

    appId: "1:856081502457:web:8579832305cceae2e89228"

  };

function encodeFB(text2) {
     var text1 = text2.replaceAll(".","%2E").replaceAll("#","%23").replaceAll("$","%24").replaceAll("/","%2F").replaceAll("[","%5B").replaceAll("]","%5D").replaceAll('"',"%22").replaceAll(":","%3A")
     return text1;
   }
   
   function decodeFB(text2) {
     var text1 = text2.replaceAll("%2E",".").replaceAll("%23","#").replaceAll("%24","$").replaceAll("%2F","/").replaceAll("%5B","[").replaceAll("%5D","]").replaceAll('%22','"').replaceAll("%3A",":")
     return text1;
   }  
  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const dbRef = ref(getDatabase());
  const db = getDatabase();
  var url1 = new URLSearchParams(window.location.search).get("url");

  onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.open("/login")
  } else {
    window.fbuid1 = user.uid
      get(child(dbRef, "users/" + fbuid1 + "/" + encodeFB(url1))).then((snapshot) => {
    if (snapshot.exists()) {
      copyIP.value = decodeFB(JSON.stringify(snapshot.val()))
      mc.innerHTML = '<h1>Restore Data</h1><p>Press the copy button below. Then close this page and paste the data into the prompt waiting for you on the previous page.</p><button style="width:500px;margin:auto;" id="gbtn" onclick="copy()">Copy</button>'
    } else {
      mc.innerHTML = "<h1>No Data</h1>"
    }
  })
  }
  });
    </script>
      </body>
</html>
