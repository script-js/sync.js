<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <title>Dashboard | sync.js</title>
  <link rel="icon" href="icon.png" />
<style>
body {margin: 0;}

ul.topnav {
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: #333;
  text-align: center;
  display: flex;
  justify-content: center;
}

ul.topnav li {float: left;}

ul.topnav li a {
  display: block;
  color: white;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

ul.topnav li a:hover:not(.active) {background-color: #111;}

ul.topnav li a.active {background-color: #1a73e8;}

ul.topnav li.right {float: right;}

@media screen and (max-width: 600px) {
  ul.topnav li.right, 
  ul.topnav li {float: none;}
}
</style>
</head>
<body>

<ul class="topnav">
  <li><a class="active" href="#" id="home" onclick="tabChange(this)">Home</a></li>
  <li><a href="#" id="data" onclick="tabChange(this)">My Data</a></li>
  <li><a href="#" id="setup" onclick="tabChange(this)">Bookmarklets</a></li>
</ul>

<div style="padding:0 16px;">
  <div id="homeC" style="text-align:center"></div>
  <div id="dataC" style="display:none">Loading...</div>
  <div id="setupC" style="display:none">
    <p>Drag these links into your bookmarks bar:</p>
<a href='javascript:void(window.open("https://sync-js.pages.dev/backup?fromURL=" + encodeURI(location.href) + "&data=" + btoa(JSON.stringify(localStorage)).replaceAll("+","%2B")))'>Back up to sync.js</a>
|
<a href='javascript:void(window.open("https://sync-js.pages.dev/get?url=" + location.href));'>Get sync.js Data</a>
|
<a href='javascript:var sjsSYSjson = JSON.parse(prompt("Paste Data:"));Object.keys(sjsSYSjson).forEach(function (k) {localStorage.setItem(k,sjsSYSjson[k])})'>Restore from sync.js</a>
  </div>
</div>
<script>
var currentTab = "home";
function tabChange(tab) {
  tab.classList = "active";
  var tabid = tab.id
  document.getElementById(tabid + "C").style.display = "block";
  document.getElementById(currentTab + "C").style.display = "none";
  document.getElementById(currentTab).classList = "";
  currentTab = tabid
}

function changeSite(site) {
  var siteid = site.id;
  if (site.innerHTML.includes("arrow_drop_down")) {
    site.innerHTML = site.innerHTML.replace("arrow_drop_down","arrow_drop_up")
    document.getElementById(siteid + "C").style.display = "block";
    site.classList = "dropdownli dropdownliFocus";
  } else if (site.innerHTML.includes("arrow_drop_up")) {
    site.innerHTML = site.innerHTML.replace("arrow_drop_up","arrow_drop_down");
    document.getElementById(siteid + "C").style.display = "none";
    site.classList = "dropdownli";
  }
}
</script>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional

  const firebaseConfig = {

    apiKey: "AIzaSyDWGbCICgDCm6XLz6gvuxnZTbsxACm-Fx4",

    authDomain: "sync-js-6aa9d.firebaseapp.com",

    projectId: "sync-js-6aa9d",

    storageBucket: "sync-js-6aa9d.appspot.com",

    messagingSenderId: "856081502457",

    appId: "1:856081502457:web:8579832305cceae2e89228"

  }; 
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const dbRef = ref(getDatabase());

  function decodeFB(text2) {
     var text1 = text2.replaceAll("%2E",".").replaceAll("%23","#").replaceAll("%24","$").replaceAll("%2F","/").replaceAll("%5B","[").replaceAll("%5D","]").replaceAll('%22','"').replaceAll("%3A",":")
     return text1;
   }  
    
  function listSites(jarray) {
    var toadd = "<p></p>";
    Object.keys(jarray).forEach(function (k) {
      var toadd2 = "";
      var arrTemp = jarray[k];
      console.log(arrTemp)
      Object.keys(arrTemp).forEach(function (k2) {
        toadd2 = toadd2 + "<p>" + decodeFB(k2) + ": " + arrTemp[k2] + "</p>"
      });
      toadd = toadd + "<a class='dropdownli' onclick='changeSite(this)' id='" + decodeFB(k) + "'>" + decodeFB(k) + " <span class='material-symbols-outlined'>arrow_drop_down</span></a><div style='display:none;padding:0 50px;' id='" + decodeFB(k) + "C'>" + toadd2 + "</div><br>";
    })
    return toadd;
  }
    window.listSites = listSites
    
onAuthStateChanged(auth, (user) => {
  if (user) {
    homeC.innerHTML = "<p></p><img src='icon.png' /><h1>Welcome, " + user.email + "</h1><button onclick='userLogout()'><span class='material-symbols-outlined'>logout</span></button><p>Select a tab above to get started.</p>";
    get(child(dbRef, "users/" + user.uid)).then((snapshot) => {
      if (snapshot.exists()) {
        dataC.innerHTML = listSites(snapshot.val());
        window.lstestarr = snapshot.val();
      } else {
        dataC.innerHTML = "<h1 style='text-align:center'>No Data Yet!</h1>"
      }
    });
  } else {
    location.replace("login")
  }
});
    function userLogout() {
      signOut(auth).then(() => {
        location.replace("/")
      }).catch((error) => {
        alert(error)
      });
    }
    window.userLogout = userLogout;
  </script>
</body>
</html>
